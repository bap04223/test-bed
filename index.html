<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Status Indicator Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f23;
            color: #e2e8f0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #1a1a2e;
            padding: 30px;
            border-radius: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #94a3b8;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #334155;
            border-radius: 6px;
            background: #1e293b;
            color: #e2e8f0;
            font-size: 16px;
        }

        /* Status indicator styles */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .status-active {
            background-color: #10b981;
            box-shadow: 0 0 4px #10b981;
        }

        .status-inactive {
            background-color: #ef4444;
            box-shadow: 0 0 4px #ef4444;
        }

        .status-checking {
            background-color: #f59e0b;
            box-shadow: 0 0 4px #f59e0b;
            animation: pulse 2s infinite;
        }

        .status-unknown {
            background-color: #6b7280;
            box-shadow: 0 0 4px #6b7280;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        button {
            padding: 10px 20px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 0 0;
        }

        button:hover {
            background: #4f46e5;
        }

        .status-info {
            margin-top: 20px;
            padding: 15px;
            background: #1e293b;
            border-radius: 6px;
            border-left: 4px solid #10b981;
        }

        .demo-controls {
            margin-top: 30px;
            padding: 20px;
            background: #16213e;
            border-radius: 8px;
        }

        h3 {
            color: #6366f1;
            margin-bottom: 15px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            width: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Chatbot Selection with Webhook Status</h2>
        
        <div class="form-group">
            <label for="chatbotSelect">Select Chatbot:</label>
            <select id="chatbotSelect">
                <option value="">Select a chatbot configuration...</option>
            </select>
        </div>

        <button onclick="checkAllWebhookStatus()">Check All Webhook Status</button>
        <button onclick="loadSampleConfigurations()">Load Sample Configs</button>

        <div id="statusInfo" class="status-info" style="display: none;">
            <h4>Webhook Status Legend:</h4>
            <p><span class="status-indicator status-active"></span>Active - Webhook is responding</p>
            <p><span class="status-indicator status-inactive"></span>Inactive - Webhook is not responding</p>
            <p><span class="status-indicator status-checking"></span>Checking - Status check in progress</p>
            <p><span class="status-indicator status-unknown"></span>Unknown - Status not checked yet</p>
        </div>

        <div class="demo-controls">
            <h3>Demo Controls</h3>
            <p>Simulate different webhook statuses:</p>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="chatbot1" checked>
                    <label for="chatbot1">Patient Simulator 1 (Active)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="chatbot2">
                    <label for="chatbot2">Patient Simulator 2 (Inactive)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="chatbot3" checked>
                    <label for="chatbot3">Mental Health Bot (Active)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="chatbot4">
                    <label for="chatbot4">Pharmacy Tutor (Inactive)</label>
                </div>
            </div>
            <button onclick="updateSimulatedStatus()">Update Simulated Status</button>
        </div>
    </div>

    <script>
        let chatbotConfigurations = [];

        // Load sample configurations
        function loadSampleConfigurations() {
            chatbotConfigurations = [
                {
                    name: "Patient Simulator 1",
                    webhookUrl: "https://your-n8n.com/webhook/patient-sim-1",
                    submitWebhookUrl: "https://your-n8n.com/webhook/submit-1",
                    description: "General patient consultation",
                    status: "unknown" // unknown, active, inactive, checking
                },
                {
                    name: "Patient Simulator 2", 
                    webhookUrl: "https://your-n8n.com/webhook/patient-sim-2",
                    submitWebhookUrl: "https://your-n8n.com/webhook/submit-2",
                    description: "Pediatric patient scenarios",
                    status: "unknown"
                },
                {
                    name: "Mental Health Bot",
                    webhookUrl: "https://your-n8n.com/webhook/mental-health",
                    submitWebhookUrl: "https://your-n8n.com/webhook/submit-mental",
                    description: "Mental health consultations",
                    status: "unknown"
                },
                {
                    name: "Pharmacy Tutor",
                    webhookUrl: "https://your-n8n.com/webhook/pharmacy-tutor",
                    submitWebhookUrl: "https://your-n8n.com/webhook/submit-tutor", 
                    description: "Educational pharmacy bot",
                    status: "unknown"
                }
            ];

            populateChatbotDropdown();
            document.getElementById('statusInfo').style.display = 'block';
        }

        // Populate dropdown with status indicators
        function populateChatbotDropdown() {
            const select = document.getElementById('chatbotSelect');
            select.innerHTML = '<option value="">Select a chatbot configuration...</option>';

            chatbotConfigurations.forEach((config, index) => {
                const option = document.createElement('option');
                option.value = index;
                
                // Create status indicator HTML
                const statusClass = `status-${config.status}`;
                const statusDot = `<span class="status-indicator ${statusClass}"></span>`;
                
                // Set option text (note: HTML won't render in option text, but we'll handle this differently)
                option.textContent = `${config.name} - ${config.description}`;
                option.setAttribute('data-status', config.status);
                
                select.appendChild(option);
            });

            // Custom styling for the select dropdown (this is a workaround since HTML in options doesn't work)
            customizeSelectOptions();
        }

        // Custom function to add visual status indicators
        function customizeSelectOptions() {
            const select = document.getElementById('chatbotSelect');
            
            // Remove any existing custom dropdown
            const existingCustom = document.querySelector('.custom-select-wrapper');
            if (existingCustom) {
                existingCustom.remove();
            }

            // Create a custom styled select
            const wrapper = document.createElement('div');
            wrapper.className = 'custom-select-wrapper';
            wrapper.style.cssText = `
                position: relative;
                display: inline-block;
                width: 100%;
            `;

            const customSelect = document.createElement('div');
            customSelect.className = 'custom-select';
            customSelect.style.cssText = `
                position: relative;
                background: #1e293b;
                border: 1px solid #334155;
                border-radius: 6px;
                padding: 12px;
                cursor: pointer;
                color: #e2e8f0;
                font-size: 16px;
            `;

            const selectedOption = document.createElement('div');
            selectedOption.className = 'selected-option';
            selectedOption.innerHTML = '<span class="status-indicator status-unknown"></span>Select a chatbot configuration...';

            const optionsList = document.createElement('div');
            optionsList.className = 'options-list';
            optionsList.style.cssText = `
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: #1e293b;
                border: 1px solid #334155;
                border-top: none;
                border-radius: 0 0 6px 6px;
                max-height: 200px;
                overflow-y: auto;
                z-index: 1000;
                display: none;
            `;

            // Add options to the custom dropdown
            chatbotConfigurations.forEach((config, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'custom-option';
                optionDiv.style.cssText = `
                    padding: 12px;
                    cursor: pointer;
                    border-bottom: 1px solid #334155;
                    transition: background-color 0.2s;
                `;
                
                const statusClass = `status-${config.status}`;
                optionDiv.innerHTML = `
                    <span class="status-indicator ${statusClass}"></span>
                    ${config.name} - ${config.description}
                `;

                optionDiv.addEventListener('mouseenter', () => {
                    optionDiv.style.backgroundColor = '#334155';
                });

                optionDiv.addEventListener('mouseleave', () => {
                    optionDiv.style.backgroundColor = 'transparent';
                });

                optionDiv.addEventListener('click', () => {
                    selectedOption.innerHTML = `
                        <span class="status-indicator ${statusClass}"></span>
                        ${config.name} - ${config.description}
                    `;
                    optionsList.style.display = 'none';
                    
                    // Update the original select
                    select.value = index;
                    
                    // Trigger change event
                    const event = new Event('change');
                    select.dispatchEvent(event);
                });

                optionsList.appendChild(optionDiv);
            });

            customSelect.appendChild(selectedOption);
            customSelect.appendChild(optionsList);
            wrapper.appendChild(customSelect);

            // Toggle dropdown
            customSelect.addEventListener('click', (e) => {
                e.stopPropagation();
                const isVisible = optionsList.style.display === 'block';
                optionsList.style.display = isVisible ? 'none' : 'block';
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', () => {
                optionsList.style.display = 'none';
            });

            // Insert the custom select after the original select
            select.style.display = 'none';
            select.parentNode.insertBefore(wrapper, select.nextSibling);
        }

        // Check webhook status (real implementation would ping the webhook)
        async function checkWebhookStatus(webhookUrl, timeoutMs = 5000) {
            try {
                // Set a timeout for the request
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeoutMs);

                // For demo purposes, we'll simulate the check
                // In real implementation, you'd do:
                /*
                const response = await fetch(webhookUrl, {
                    method: 'HEAD', // or 'GET' with minimal payload
                    signal: controller.signal,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    mode: 'cors'
                });
                clearTimeout(timeoutId);
                return response.ok;
                */

                // Simulate check delay
                await new Promise(resolve => setTimeout(resolve, Math.random() * 2000 + 500));
                clearTimeout(timeoutId);
                
                // Simulate different responses based on URL
                if (webhookUrl.includes('patient-sim-2') || webhookUrl.includes('pharmacy-tutor')) {
                    return false; // Simulate inactive
                }
                return true; // Simulate active

            } catch (error) {
                console.error('Webhook check failed:', error);
                return false;
            }
        }

        // Check all webhook statuses
        async function checkAllWebhookStatus() {
            for (let i = 0; i < chatbotConfigurations.length; i++) {
                const config = chatbotConfigurations[i];
                config.status = 'checking';
            }
            
            // Update UI immediately to show checking status
            populateChatbotDropdown();

            // Check each webhook
            for (let i = 0; i < chatbotConfigurations.length; i++) {
                const config = chatbotConfigurations[i];
                
                try {
                    const isActive = await checkWebhookStatus(config.webhookUrl);
                    config.status = isActive ? 'active' : 'inactive';
                } catch (error) {
                    config.status = 'inactive';
                }

                // Update UI after each check
                populateChatbotDropdown();
            }
        }

        // Update simulated status based on checkboxes (for demo)
        function updateSimulatedStatus() {
            const checkboxes = ['chatbot1', 'chatbot2', 'chatbot3', 'chatbot4'];
            
            checkboxes.forEach((checkboxId, index) => {
                const checkbox = document.getElementById(checkboxId);
                if (chatbotConfigurations[index]) {
                    chatbotConfigurations[index].status = checkbox.checked ? 'active' : 'inactive';
                }
            });

            populateChatbotDropdown();
        }

        // Auto-load sample configurations on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadSampleConfigurations();
        });
    </script>
</body>
</html>
